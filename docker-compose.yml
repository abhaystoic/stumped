version: '3.7'
services:
  data-distribution-ms:
    container_name: data-distribution-ms-container
    build:
      context: data-distribution-ms/.
    image: abhaystoic/data-distribution-ms:latest
    restart: 'no'
    volumes:
      - ~/docker-data/data-distribution-ms/data/mongodb:/data/db
      - ~/docker-data/data-distribution-ms/data/mongoconfig:/data/configdb
      - ~/docker-data/data-distribution-ms/celery-beat-logs:/celery-beat-logs
    environment:
      - MONGO_INITDB_DATABASE=news
      - MONGO_INITDB_ROOT_USERNAME=admin
      - MONGO_INITDB_ROOT_PASSWORD=admin123
    ports:
      - 27018:27017
      - 5673:5672
      - 15673:15672
    networks:
      - stumped-back
  
  headlines-ms:
    container_name: headlines-ms-container
    privileged: true
    build:
      context: headlines-ms/.                                                                                                                                                                                                                                                                                                                                 
    image: abhaystoic/headlines-ms:latest
    restart: 'no'
    volumes:
      - ~/docker-data/headlines-ms/www:/var/www
      - ~/docker-data/headlines-ms/data/mongodb:/data/db
      - ~/docker-data/headlines-ms/data/mongoconfig:/data/configdb
    environment:
      - MONGO_INITDB_DATABASE=headline
      - MONGO_INITDB_ROOT_USERNAME=admin
      - MONGO_INITDB_ROOT_PASSWORD=admin123
    ports:
      - 5001:80
      - 5004:5000
      - 27019:27017
    links:
      - data-distribution-ms
    networks:
      - stumped-back
  
  covid19-ms:
    container_name: covid19-ms-container
    # privileged: true
    build:
      context: covid19-ms/.                                                                                                                                                                                                                                                                                                                                 
    image: abhaystoic/covid19-ms:latest
    restart: 'no'
    volumes:
      - ~/docker-data/covid19-ms/www:/var/www
      - ~/docker-data/covid19-ms/data/mongodb:/data/db
      - ~/docker-data/covid19-ms/data/mongoconfig:/data/configdb
    environment:
      - MONGO_INITDB_DATABASE=covid19
      - MONGO_INITDB_ROOT_USERNAME=admin
      - MONGO_INITDB_ROOT_PASSWORD=admin123
    ports:
      - 5002:80
      - 5006:5000
      - 27020:27017
    links:
      - data-distribution-ms
    networks:
      - stumped-back
  
  alll-news-ms:
    container_name: alll-news-ms-container
    # privileged: true
    build:
      context: alll-news-ms/.                                                                                                                                                                                                                                                                                                                                 
    image: abhaystoic/alll-news-ms:latest
    restart: 'no'
    volumes:
      - ~/docker-data/alll-news-ms/www:/var/www
      - ~/docker-data/alll-news-ms/data/mongodb:/data/db
      - ~/docker-data/alll-news-ms/data/mongoconfig:/data/configdb
    environment:
      - MONGO_INITDB_DATABASE=all_news
      - MONGO_INITDB_ROOT_USERNAME=admin
      - MONGO_INITDB_ROOT_PASSWORD=admin123
    ports:
      - 5003:80
      - 5007:5000
      - 27021:27017
    links:
      - data-distribution-ms
    networks:
      - stumped-back

networks:
  stumped-back:
    driver: bridge
